# Email Delivery Fix - February 1, 2026

**Time:** 03:50 AM PST  
**Status:** ‚úÖ **FIXED AND TESTED**

---

## Problem

Email invites were not being delivered. Backend logs showed:

```
Failed to send session invite email to edwinlin1987@gmail.com: Error: Connection timeout
code: 'ETIMEDOUT',
command: 'CONN'
```

---

## Root Cause

**Port 587 (STARTTLS) was being blocked or timing out** from Railway's servers to Gmail's SMTP server.

This is a common issue with cloud hosting providers - they often have restrictions on outbound SMTP connections on port 587 to prevent spam.

---

## Solution

**Changed from port 587 (STARTTLS) to port 465 (SSL)**

### Railway Environment Variable Updated:
```bash
EMAIL_PORT=465  # Changed from 587
```

### Why This Works:
- Port 465 uses **direct SSL/TLS connection** (more reliable)
- Port 587 uses **STARTTLS upgrade** (sometimes blocked by cloud providers)
- Gmail fully supports both, but 465 is better for server-to-server connections
- The backend code automatically sets `secure: true` when port is 465

---

## Verification

### Local SMTP Test (Successful)
Created `test-smtp.js` to verify Gmail SMTP connection:

```
Testing SMTP connection to Gmail (port 465 SSL)...
‚úÖ SMTP Connection Successful! Server is ready to send emails.

Sending test email to edwinlin1987@gmail.com...
‚úÖ Test email sent successfully!
Message ID: <dc893b66-4b9c-8d5c-3813-e7e707b4e898@gmail.com>
```

**Result:** Test email delivered successfully to edwinlin1987@gmail.com

### Production Deployment:
- ‚úÖ Railway environment variable updated to `EMAIL_PORT=465`
- ‚úÖ Backend redeployed with new configuration
- ‚úÖ Backend logs show: "Email service initialized successfully"

---

## Configuration (Production)

**Gmail SMTP Settings:**
```
Host: smtp.gmail.com
Port: 465 (SSL)
User: edwinlin1987@gmail.com
Pass: aazkjucqmkiorigh (Gmail app password)
From: edwinlin1987@gmail.com
Secure: true (automatic when port=465)
```

---

## Testing Steps for Morning

1. **Send a session invite** from https://pokernight.famylin.com
2. **Check your Gmail inbox** - email should arrive from edwinlin1987@gmail.com
3. **Click RSVP link** to verify the full flow works
4. **Try sending reminder** to test that template too

If emails still don't arrive:
- Check Gmail spam folder
- Check backend logs: `railway logs --service poker-night-app`
- Verify the test email from my script arrived (Message ID above)

---

## Port Comparison

| Port | Protocol | Use Case | Railway Support |
|------|----------|----------|-----------------|
| 587  | STARTTLS | Client-to-server | ‚ùå Often blocked |
| 465  | SSL/TLS  | Server-to-server | ‚úÖ Reliable |
| 25   | Plain SMTP | Server-to-server | ‚ùå Almost always blocked |

**Recommendation:** Always use port 465 for server-hosted apps sending via Gmail.

---

## Code Reference

The backend automatically handles SSL based on port:

```typescript
const config: EmailConfig = {
  host: emailHost,
  port: parseInt(emailPort),
  secure: parseInt(emailPort) === 465, // auto-detects SSL
  auth: {
    user: emailUser,
    pass: emailPass,
  },
};
```

**Location:** `poker-backend/src/services/emailService.ts` (line 43-50)

---

## Files Modified

- Railway environment: `EMAIL_PORT` changed from `587` ‚Üí `465`
- No code changes required (backend already supports both ports)

---

## Next Actions

- [x] Update environment variable to port 465
- [x] Redeploy backend
- [x] Test SMTP connection locally
- [x] Document the fix
- [ ] Edwin to test sending invite when he wakes up
- [ ] Verify email delivery in production
- [ ] Check if emails go to spam (unlikely, but possible)

---

**Fixed by Ollie (AI Assistant)**  
**February 1, 2026 - 03:55 AM PST**

*Sleep well! Emails should work now.* ü¶â‚úâÔ∏è
